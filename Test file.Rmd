---
title: "Test file"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(skimr)
library(janitor)
library(lubridate)
```

### Data description

#### Headcount Data

```{r}
headcount <- read.csv("Headcount Filtered.csv")
headcount <- clean_names(headcount)
headcount2 <- read.csv("Headcount Report APAC_MAY 2019.csv")
headcount2 <- clean_names(headcount2)
headcount3 <- read.csv("Headcount Filtered Connors.csv")
headcount3 <- clean_names(headcount3)
```

Add all the data tables together, remove insignificant columns
pers_no
last_name
first_name
country
personnel_subarea
personnel_area
employee_subgroup
man_persno - personal number of the manager - absent in headcount 2.
manager - headcount 2 has a manager instead with a wrong format.
date
function
organizational_unit
employee_group - add other to the data
empl - irrelevant data (99% of the data has the same value)
position
cost_centre_number
cost_centre_description
travel_cost_code - headcount 2 has a travel_cost_centre as a code and a travel_cost_centre1
travel_cost_centre
salaried_waged
location
fullname - absent in headcount 2 
presno2 - repeating the column pers_no
pers_count - all have the exact same value of 1
connors - all the data has a value of 1 in headcount 3.
Headcount 3 has the same formatting as headcount.

```{r}
headcount <- headcount %>%
  select(-presno2, -empl)
headcount3 <- headcount3 %>%
  select(-presno2, -empl, -connors)
headcount2 <- headcount2 %>%
  select(-empl)
headcount2$pers_count <- 1
```

Instead of two column of first name and last name, one column named full name was created. We got rid of all extra white spaces and changed the order from last name, comma, first name to last name and first name. The new column was named full_name. Also changed the format of the name, some were all lower letter, so we changed that.

```{r}
headcount <- headcount %>%
  mutate(first_name = str_trim(first_name),
         last_name = str_trim(last_name),
         full_name = str_c(last_name, " ", first_name),
         full_name = str_trim(full_name),
         full_name = str_to_title(full_name),
         manager = str_replace(manager, ",", " "),
         manager = str_trim(manager),
         manager = str_to_title(manager),
         pers_no = as.character(pers_no),
         man_persno = as.character(man_persno)) %>%
  select(-fullname, -first_name, -last_name)
headcount3 <- headcount3 %>%
  mutate(first_name = str_trim(first_name),
         last_name = str_trim(last_name),
         full_name = str_c(last_name, " ", first_name),
         full_name = str_trim(full_name),
         full_name = str_to_title(full_name),
         manager = str_replace(manager, ",", " "),
         manager = str_trim(manager),
         manager = str_to_title(manager),
         pers_no = as.character(pers_no),
         pers_no = as.character(pers_no),
         man_persno = as.character(man_persno)) %>%
  select(-fullname, -first_name, -last_name)
headcount2 <- headcount2 %>%
  mutate(first_name = str_trim(first_name),
         last_name = str_trim(last_name),
         full_name = str_c(last_name, " ", first_name),
         full_name = str_trim(full_name),
         full_name = str_to_title(full_name),
         pers_no = as.character(pers_no)) %>%
  select(-first_name, -last_name)
```

Changing the travel cost code and manager column to fit the full_name column.

```{r}
headcount2 <- headcount2 %>%
  rename(travel_cost_code = travel_cost_centre) %>%
  rename(travel_cost_centre = travel_cost_centre_1) %>%
  mutate(manager = str_replace(manager, " ,", ""),
         manager = str_replace(manager, ",", ""),
         manager = str_trim(manager),
         manager = str_to_title(manager))
```

```{r}
id_empl1 <- headcount %>%
  select(pers_no, full_name)
id_empl2 <- headcount2 %>%
  select(pers_no, full_name)
id_empl3 <- headcount3 %>%
  select(pers_no, full_name)
id_empl <- union(id_empl1, id_empl2)
id_empl <- union(id_empl, id_empl3)
```

```{r}
headcount2 <- left_join(headcount2, id_empl, by = c("manager" = "full_name"))
headcount2 <- rename(headcount2, c("man_persno" = "pers_no.y"))
headcount2 <- rename(headcount2, c("pers_no" = "pers_no.x"))

```

```{r}
combined_headcount <- union(headcount, headcount2)
combined_headcount <- union(combined_headcount, headcount3)
```

```{r}
combined_headcount <- distinct(combined_headcount)
combined_headcount <- combined_headcount %>% mutate(across(where(is.character), str_trim))
```

```{r}
write.csv(combined_headcount,"combined_headcount.csv", row.names = FALSE)
```


#### Turnover Data

```{r}
turnover <- read.csv("ANZ_IND_Turnover.csv")
turnover <- clean_names(turnover)
new_starter <- read.csv("ANZ_IND_New Starter Data.csv")
new_starter <- clean_names(new_starter) %>%
  select(-start_date_action, -end_date_action, -position, -organizational_key)
termination <- read.csv("ANZ_IND_Termination Data.csv")
termination <- clean_names(termination)
```

```{r}
new_starter <- rename(new_starter, c('co_cd' = 'company_code'))
new_starter <- rename(new_starter, c('company_code' = 'company_code_1'))
termination <- rename(termination, c('date' = 'start_date_action'))
turnover <- rename(turnover, c('cost_ctr' = 'cost_ctr_code'))
new_starter$turnover <- 1
new_starter$turn_abs <- 1
termination$turnover <- -1
termination$turn_abs <- 1
new_starter <- new_starter %>%
  mutate(action_type = str_replace(action_type, 'Hiring', 'Hire Employee'))
turnover <- turnover %>%
  mutate(action_type = str_replace(action_type, 'Hiring', 'Hire Employee'))
```

```{r}
combined_turnover <- union(new_starter, termination)
combined_turnover <- union(combined_turnover, turnover)
combined_turnover <- distinct(combined_turnover)
combined_turnover <- combined_turnover %>% mutate(across(where(is.character), str_trim))
```


```{r}
hiring <- read.csv("ANZ_IND_New Starter Data.csv")
hiring <- clean_names(hiring)
hiring <- hiring %>% mutate(across(where(is.character), str_trim))
hiring <- hiring %>%
  mutate(action_type = str_replace(action_type, 'Hiring', 'Hire Employee'))
```

```{r}
write.csv(combined_turnover,"combined_turnover.csv", row.names = FALSE)
write.csv(hiring,"hiring.csv", row.names = FALSE)
```


pers_no - id
action_type - resignation or hiring
reason_for_action - reason
co_cd and company_code 
company_code
personell_area
cost_ctr
cost_center
organizational_unit
date
turnover
turn_abs


